            } catch (error) {\n                alert(error.message || '매장 정보를 가져오는데 실패했습니다.');\n            } finally {\n                loadingSpinner.style.display = 'none';\n            }\n        }\n\n        // 전체 선택/해제\n        document.addEventListener('DOMContentLoaded', function() {\n            const selectAllCheckbox = document.getElementById('selectAllStores');\n            if (selectAllCheckbox) {\n                selectAllCheckbox.addEventListener('change', function() {\n                    const checkboxes = document.querySelectorAll('.store-item input[type=\"checkbox\"]');\n                    checkboxes.forEach(checkbox => {\n                        checkbox.checked = this.checked;\n                        checkbox.dispatchEvent(new Event('change'));\n                    });\n                });\n            }\n        });\n\n        // 선택된 매장 수 업데이트\n        function updateSelectedCount() {\n            const count = Object.keys(selectedStores).filter(key => selectedStores[key]).length;\n            document.getElementById('selectedCount').textContent = `${count}개 선택됨`;\n        }\n\n        // 전역 스코프에 함수 등록\n        window.fetchStores = fetchStores;\n\n        // 버튼 클릭 이벤트 리스너 추가\n        document.getElementById('fetchStoresBtn').addEventListener('click', fetchStores);\n\n        // 폼 제출 - API 경로 수정됨\n        document.getElementById('storeRegisterForm').addEventListener('submit', async (e) => {\n            e.preventDefault();\n\n            // 선택된 매장이 있는지 확인\n            const validStores = Object.values(selectedStores).filter(store => store);\n            if (validStores.length === 0) {\n                alert('등록할 매장을 선택해주세요.');\n                return;\n            }\n\n            const formData = new FormData(e.target);\n            const platform = formData.get('platform');\n            \n            // 플랫폼별 최대 글자 수 설정\n            let maxLength = 450; // 기본값 (배민, 요기요)\n            if (platform === 'coupang') {\n                maxLength = 300;\n            }\n            \n            // 공통 설정\n            const commonSettings = {\n                platform: platform,\n                platform_id: formData.get('platform_id'),\n                platform_pw: formData.get('platform_pw'),\n                greeting_start: formData.get('greeting_start'),\n                greeting_end: formData.get('greeting_end') || null,\n                role: formData.get('role'),\n                tone: formData.get('tone'),\n                prohibited_words: JSON.parse(formData.get('prohibited_words')),\n                max_length: maxLength,\n                rating_5_reply: formData.get('rating_5_reply') === 'on',\n                rating_4_reply: formData.get('rating_4_reply') === 'on',\n                rating_3_reply: formData.get('rating_3_reply') === 'on',\n                rating_2_reply: formData.get('rating_2_reply') === 'on',\n                rating_1_reply: formData.get('rating_1_reply') === 'on',\n                auto_reply_enabled: true,\n                auto_reply_hours: formData.get('auto_reply_hours'),\n                reply_delay_minutes: parseInt(formData.get('reply_delay_minutes')),\n                weekend_enabled: true,  // 기본 true\n                holiday_enabled: false, // 기본 false\n                store_type: formData.get('store_type')\n            };\n\n            try {\n                let successCount = 0;\n                let failCount = 0;\n                \n                // 각 매장별로 등록\n                for (const store of validStores) {\n                    const data = {\n                        ...commonSettings,\n                        platform_code: store.platform_code,\n                        store_name: store.store_name\n                    };\n                    \n                    try {\n                        const response = await apiRequest('/stores/register', {\n                            method: 'POST',\n                            body: JSON.stringify(data)\n                        });\n\n                        if (response.success) {\n                            successCount++;\n                        } else {\n                            failCount++;\n                            console.error(`매장 등록 실패: ${store.store_name}`, response.message);\n                        }\n                    } catch (error) {\n                        failCount++;\n                        console.error(`매장 등록 오류: ${store.store_name}`, error);\n                    }\n                }\n                \n                // 결과 표시\n                if (successCount > 0 && failCount === 0) {\n                    alert(`${successCount}개 매장이 성공적으로 등록되었습니다!`);\n                    window.location.href = '/stores';\n                } else if (successCount > 0 && failCount > 0) {\n                    alert(`전체 ${validStores.length}개 중 ${successCount}개 성공, ${failCount}개 실패했습니다.`);\n                    window.location.href = '/stores';\n                } else {\n                    alert('모든 매장 등록에 실패했습니다.');\n                }\n            } catch (error) {\n                alert(error.message || '매장 등록 중 오류가 발생했습니다.');\n            }\n        });\n    </script>\n</body>\n</html>"